<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Object Detection</title>
    <!-- Bootstrap CSS -->
    <link 
        rel="stylesheet" 
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" 
        crossorigin="anonymous"
    >
</head>
<body>
    <!-- Main Content -->
    <div class="container">
        <h1 class="text-center mb-3 mt-1">Object Detection</h1>

        <!-- Camera Box -->
        <div class="card mb-4 mt-2">
            <div class="card-body text-center d-flex justify-content-center">
                <video id="video" class="rounded" width="300vw" autoplay></video>
            </div>

        <!-- Output Section -->
            <div id="output" class="mb-4 mt-1" style="display: none;">
                <div class="text-center">
                    <img id="processedImage" class="rounded" width="300vw">
                </div>
            </div>
            
            <!-- Buttons -->
            <div id="button-container" class="d-flex justify-content-center">
                <button id="capture" class="btn btn-primary mx-2 mb-3" onclick="capturePhoto()">Capture Photo</button>
                <button id="new-picture" class="btn btn-secondary mx-2 mb-3" onclick="resetCamera()" style="display: none;">New Picture</button>
            </div>
        </div>        

        <!-- Results Section -->
        <div id="results" class="card">
            <div class="card-body">
                <!-- Results will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script 
        src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" 
        crossorigin="anonymous"
    ></script>
    <script 
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" 
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" 
        crossorigin="anonymous"
    ></script>
    <script 
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" 
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" 
        crossorigin="anonymous"
    ></script>

    <!-- Your JavaScript Code -->
    <script>
        const video = document.getElementById('video');
        
        // Access webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => video.srcObject = stream)
            .catch(err => console.error(err));

        function capturePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 480;
            canvas.getContext('2d').drawImage(video, 0, 0, 640, 480);
            
            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('image', blob, 'photo.jpg');

                fetch('/detect', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('output').style.display = 'block';
                    document.getElementById('new-picture').style.display = 'block';
                    document.getElementById('processedImage').src = data.image;
                    document.getElementById('capture').style.display = 'none';
                    video.style.display = 'none';
                    
                    let resultsHtml = '<h3>Detection Results:</h3>';
                    if (data.results.length > 0) {
                        data.results.forEach(result => {
                            resultsHtml += `
                                <p>Detected ${result.class} 
                                (Score: ${result.score}, 
                                Weight: ${result.weight} kg)</p>
                            `;
                        });
                    } else {
                        resultsHtml += '<p>No objects detected</p>';
                    }
                    document.getElementById('results').innerHTML = resultsHtml;
                });
            }, 'image/jpeg', 0.9);
        }

        function resetCamera() {
            document.getElementById('output').style.display = 'none';
            document.getElementById('new-picture').style.display = 'none';
            video.style.display = 'block';
            document.getElementById('results').innerHTML = '';
            document.getElementById('capture').style.display = 'block';
        }
    </script>
</body>
</html>
